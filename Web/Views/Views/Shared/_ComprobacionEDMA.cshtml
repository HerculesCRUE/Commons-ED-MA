@*[security|||shared/_comprobacionedma.cshtml|||hercules]*@
@{
	bool ED_HABILITADO = Html.Translate("ED_HABILITADO") == "true";
	bool MA_HABILITADO = Html.Translate("MA_HABILITADO") == "true";
	if(!ED_HABILITADO && !MA_HABILITADO)
	{
		//Si no está habilitado ni ed ni ma redirigimos a 404
		Context.Response.Redirect(Html.GetComunidad().Url+"/error404");
	}
	bool disponible = false;

	if ((ViewBag.ED_DISPONIBLE && ED_HABILITADO)|| (ViewBag.MA_DISPONIBLE && MA_HABILITADO))
	{
		disponible=true;
	}

	if (!disponible)
	{		
		if((Context.Request.Path==""|| Context.Request.Path=="/"))
		{
			if(!MA_HABILITADO)
			{
				//Estamos intentando entrar a la home y no está MA habilotado
				Context.Response.Redirect(Html.GetComunidad().Url + "/homeed");
			}
		}else
		{
			// Si la página no está disponible, redirigimos a la home.
			Context.Response.Redirect(Html.GetComunidad().Url);
		}
	}
	else if (disponible && !ViewBag.MA_DISPONIBLE && Html.GetIdentidadActual().IsGuestUser)
	{
		// Si la página es de ED y el usuario no está logeado, lo redirigimos a la página de login.
		Context.Response.Redirect(Html.GetComunidad().Url + "/login/redirect" + Context.Request.Path);
	}
}